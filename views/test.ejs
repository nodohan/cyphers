<!DOCTYPE html>
<html lang="ko">

<head>
    <%- include  ("./layout/head") %>

        <script type="text/javascript">
            $(document).ready(function() {
                $("#mainMenu").removeClass("active");
                $("#userDetailMenu").addClass("active");

            });

            function searchDetail() {
                searchUser("nickNames", null, $("#nickNames").val(), setUserDetailInfo);
            }

            function setUserDetailInfo(data) {
                let gameType = $("input[name='gameType']:checked").val();

                $("#con1_2").empty();
                $("#con2_2").empty();

                drawLeftInfo(gameType, data);
                drawRightInfo(gameType, data);
            }

            function drawRightInfo(gameType, data) {
                var div = $("#template2").clone();

                var rows = data.matches.rows;
                drawMapInfo(rows, div, 101, "#river"); //리버포트
                drawMapInfo(rows, div, 102, "#metro"); //메트로폴리스
                drawMapInfo(rows, div, 103, "#bristol"); //브리스톨
                drawMapInfo(rows, div, 104, "#spring"); //스프링필드
                drawMapInfo(rows, div, 105, "#asia"); //그랑플람 아시아 지부

                div.show();

                $("#con2_2").empty().append(div);
            }

            function drawLeftInfo(gameType, data) {
                var rating = data.records.filter(game => game.gameTypeId == gameType)[0];
                var pov = (rating.winCount * 100) / (rating.winCount + rating.loseCount);

                //기본 정보
                var clone = $("#template").clone();
                clone.attr("id", getUserDivId(gameType, data.nickname));
                $(clone).find("#gameTypeDiv").text("[" + (gameType == 'rating' ? "공식전" : "일반전") + "]");
                $(clone).find("#nickNameDiv").text(data.nickname);
                $(clone).find("#levelDiv").text(data.grade + "급");
                $(clone).find("#clanDiv").text(data.clanName);

                $(clone).find("#currRP").text(data.ratingPoint);
                $(clone).find("#maxRP").text(data.maxRatingPoint);
                //$(clone).find("#playGameDiv").text("승률 : " + pov.toFixed(0) + "% [" + (rating.winCount + rating.loseCount) + "전 " + rating.winCount + "승 " + rating.loseCount + "패 " + rating.stopCount + "중단]");
                $(clone).find("#playGameDiv").text("승률 : " + pov.toFixed(0) + "% [" + rating.winCount + "승 " + rating.loseCount + "패 " + rating.stopCount + "중단]");

                var rows = data.matches.rows;

                //포지션 별 승률
                drawPosition(clone, rows);

                //최근 5경기 결과
                drawRecently(clone, rows);

                //자주하는 캐릭
                var userChar = extractChar(rows, sortCase);
                drawCharInfo(clone, userChar, "자주하는 TOP"); //"높은승률 TOP"

                clone.show();
                $("#con1_2").prepend(clone);
            }

            /***
             * 맵별 포지션 승률
             */
            function drawMapInfo(rows, div, mapId, mapName) {
                //포지션별 승률
                var mapRow = extractMap(rows, mapId);
                drawPosition(div.find(mapName), mapRow);

                var userMapChar = extractChar(mapRow, highScore);
                drawCharInfo(div.find(mapName).find("#often"), userMapChar, "높은승률 TOP");
            }
        </script>
</head>

<body class="body">
    <%- include  ("./layout/menu") %>

        <div role="alert" aria-live="assertive" aria-atomic="true" class="toast fade show" data-autohide="false">
            <div class="toast-header">
                <svg class="bd-placeholder-img rounded mr-2" width="20" height="20" xmlns="http://www.w3.org/2000/svg" role="img" aria-label=" :  " preserveAspectRatio="xMidYMid slice" focusable="false"><title> </title><rect width="100%" height="100%" fill="#007aff"></rect><text x="50%" y="50%" fill="#dee2e6" dy=".3em">공식 </text></svg>

                <strong class="mr-auto">마을주민1</strong>
                <small>11 mins ago</small>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
            </div>
            <div class="toast-body">
                Hello, world! This is a toast message.
            </div>
        </div>

        <div id="main">
            <div class="top">
                <input type="radio" name="gameType" id="gameType_rating" value="rating" checked="">
                <label for="gameType_rating"> 공식 </label>
                <input type="radio" name="gameType" id="gameType_normal" value="normal">
                <label for="gameType_normal"> 일반 </label>
            </div>
            <div id="con1" class="con">
                <h3>상세</h3>
                <input type="text" class="longText" id="nickNames" onkeypress="if(event.keyCode == 13) { searchDetail(); } " placeholder="한명만 검색하세요">
                <input type="button" value="검색" oncdivck="searchDetail();">
                <input type="button" value="초기화" oncdivck="clearDiv('con1_2');"><br>
                <div id="con1_2" class="infoLayer2">



                    <div id="마을주민1_rating" class="infoDiv" style="">
                        <div id="defaultDiv">
                            <div id="gameTypeDiv" class="red bold width100p">[공식전]</div>
                            <div class="width100p">
                                <div id="nickNameDiv" class="width25p bold">마을주민1</div>
                                <div id="levelDiv" class="width25p">104급</div>
                                <div id="clanDiv" class="width33p">알아서피해라</div>
                            </div>
                            <div class="width100p">
                                <div class="width25p">현재 rp : <span id="currRP" class="bold red">2364</span></div>
                                <div class="width25p">최고 rp : <span id="maxRP">2375</span></div>
                                <div id="playGameDiv">승률 : 52% [128승 119패 2중단]</div>
                            </div>
                        </div>
                        <div id="positionDiv">
                            <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position1.jpg"> <span id="tankerSpan">48% (82승 89패)</span></div>
                            <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position2.jpg"> <span id="meleeSpan">53% (10승 9패)</span></div>
                            <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position3.jpg"> <span id="adSpan">53% (82승 72패)</span></div>
                            <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position4.jpg"> <span id="suppSpan">100% (2승 0패)</span></div>
                        </div>
                        <div id="recentlyDiv">
                            <div class="width100p bold" id="recentlyDivTitle">최근 10게임</div>
                            <div id="recentlyResultDiv" class="width100p parent">

                                <a data-toggle="collapse" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    <span class="bold red">승</span>
                                    <span class="bold red">승</span>
                                    <span class="bold blue">패</span>
                                    <span class="bold blue">패</span>
                                    <span class="bold red">승</span>
                                    <span class="bold red">승</span>
                                    <span class="bold blue">패</span>
                                    <span class="bold blue">패</span>
                                    <span class="bold blue">패</span>
                                    <span class="bold red">승</span>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div id="mostCharDiv">
                        <div id="mostCharTitleDiv" class="width100p bold">자주하는 TOP3(5판이상)</div>
                        <div id="mostCharDetailDiv">
                            <!-- 자주하는 캐릭 top3 -->
                            <div class="card">
                                <div class="row no-gutters">
                                    <div class="col-md-4">
                                        <img src="https://img-api.neople.co.kr/cy/characters/5f4c4d6d332766ca219af12dfc41f124">
                                    </div>
                                    <div class="col-md-8">
                                        <div class="card-body">
                                            <p class="card-text">57% <br> <small class="text-muted">79승 60패</small></p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="row no-gutters">
                                    <div class="col-md-4">
                                        <img src="https://img-api.neople.co.kr/cy/characters/df9599b5be8c37266f7ded9cd2becf60">
                                    </div>
                                    <div class="col-md-8">
                                        <div class="card-body">
                                            <p class="card-text">50% <br><small class="text-muted">64승 63패</small></p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="row no-gutters">
                                    <div class="col-md-4">
                                        <img src="https://img-api.neople.co.kr/cy/characters/0c972ec7ba90f52229419f6b44a71c89">
                                    </div>
                                    <div class="col-md-8">
                                        <div class="card-body">
                                            <p class="card-text"> 52% <br> <small>12승 11패</small></p>
                                        </div>
                                    </div>
                                </div>
                            </div>



                        </div>
                    </div>

                </div>

            </div>
        </div>
        </div>
        <div id="con2" class="con">
            <h3>맵별 승률</h3>
            <div id="con2_2" class="infoLayer2">
                <div id="template2" style="">
                    <div id="river" class="mapCard">
                        <div class="bold width100p">리버포드</div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position1.jpg"> <span id="tankerSpan">47% (21승 24패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position2.jpg"> <span id="meleeSpan">33% (2승 4패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position3.jpg"> <span id="adSpan">51% (20승 19패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position4.jpg"> <span id="suppSpan">100% (1승 0패)</span></div>
                        <div id="often" class="width100p">
                            <div id="mostCharTitleDiv" class="width100p bold">높은승률 TOP2(5판이상)</div>
                            <div id="mostCharDetailDiv">
                                <!-- 자주하는 캐릭 top3 -->
                                <img class="drawIcon" src="https://img-api.neople.co.kr/cy/characters/5f4c4d6d332766ca219af12dfc41f124"> 57% (21승 16패) <img class="drawIcon" src="https://img-api.neople.co.kr/cy/characters/df9599b5be8c37266f7ded9cd2becf60">                                49% (17승 18패)</div>
                        </div>
                    </div>
                    <div id="metro" class="mapCard">
                        <div class="bold width100p">메트로폴리스</div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position1.jpg"> <span id="tankerSpan">51% (23승 22패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position2.jpg"> <span id="meleeSpan">50% (2승 2패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position3.jpg"> <span id="adSpan">59% (23승 16패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position4.jpg"> <span id="suppSpan">100% (1승 0패)</span></div>
                        <div id="often" class="width100p">
                            <div id="mostCharTitleDiv" class="width100p bold">높은승률 TOP3(5판이상)</div>
                            <div id="mostCharDetailDiv">
                                <!-- 자주하는 캐릭 top3 -->
                                <img class="drawIcon" src="https://img-api.neople.co.kr/cy/characters/caa0168d0c68ec4dfe64d025df2673f0"> 83% (5승 1패) <img class="drawIcon" src="https://img-api.neople.co.kr/cy/characters/5f4c4d6d332766ca219af12dfc41f124">                                67% (24승 12패) <img class="drawIcon" src="https://img-api.neople.co.kr/cy/characters/df9599b5be8c37266f7ded9cd2becf60"> 54% (15승 13패)</div>
                        </div>
                    </div>
                    <div id="bristol" class="mapCard">
                        <div class="bold width100p">브리스톨</div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position1.jpg"> <span id="tankerSpan">42% (10승 14패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position2.jpg"> <span id="meleeSpan">60% (3승 2패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position3.jpg"> <span id="adSpan">33% (5승 10패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position4.jpg"> <span id="suppSpan">없음</span></div>
                        <div id="often" class="width100p">
                            <div id="mostCharTitleDiv" class="width100p bold">높은승률 TOP2(5판이상)</div>
                            <div id="mostCharDetailDiv">
                                <!-- 자주하는 캐릭 top3 -->
                                <img class="drawIcon" src="https://img-api.neople.co.kr/cy/characters/df9599b5be8c37266f7ded9cd2becf60"> 43% (9승 12패) <img class="drawIcon" src="https://img-api.neople.co.kr/cy/characters/5f4c4d6d332766ca219af12dfc41f124">                                38% (5승 8패)</div>
                        </div>
                    </div>
                    <div id="spring" class="mapCard">
                        <div class="bold width100p">스프링필드</div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position1.jpg"> <span id="tankerSpan">52% (15승 14패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position2.jpg"> <span id="meleeSpan">100% (2승 0패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position3.jpg"> <span id="adSpan">55% (16승 13패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position4.jpg"> <span id="suppSpan">없음</span></div>
                        <div id="often" class="width100p">
                            <div id="mostCharTitleDiv" class="width100p bold">높은승률 TOP2(5판이상)</div>
                            <div id="mostCharDetailDiv">
                                <!-- 자주하는 캐릭 top3 -->
                                <img class="drawIcon" src="https://img-api.neople.co.kr/cy/characters/df9599b5be8c37266f7ded9cd2becf60"> 67% (14승 7패) <img class="drawIcon" src="https://img-api.neople.co.kr/cy/characters/5f4c4d6d332766ca219af12dfc41f124">                                52% (13승 12패)</div>
                        </div>
                    </div>
                    <div id="asia" class="mapCard">
                        <div class="bold width100p">그랑플람 아시아지부</div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position1.jpg"> <span id="tankerSpan">46% (13승 15패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position2.jpg"> <span id="meleeSpan">50% (1승 1패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position3.jpg"> <span id="adSpan">56% (18승 14패)</span></div>
                        <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position4.jpg"> <span id="suppSpan">없음</span></div>
                        <div id="often" class="width100p">
                            <div id="mostCharTitleDiv" class="width100p bold">높은승률 TOP2(5판이상)</div>
                            <div id="mostCharDetailDiv">
                                <!-- 자주하는 캐릭 top3 -->
                                <img class="drawIcon" src="https://img-api.neople.co.kr/cy/characters/5f4c4d6d332766ca219af12dfc41f124"> 57% (16승 12패) <img class="drawIcon" src="https://img-api.neople.co.kr/cy/characters/df9599b5be8c37266f7ded9cd2becf60">                                41% (9승 13패)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <div id="template" class="infoDiv" style="display:none">
            <div id="defaultDiv">
                <div id="gameTypeDiv" class="red bold width100p"></div>
                <div class="width100p">
                    <div id="nickNameDiv" class="width25p bold"></div>
                    <div id="levelDiv" class="width25p"></div>
                    <div id="clanDiv" class="width33p"></div>
                </div>
                <div class="width100p">
                    <div class="width25p">현재 rp : <span id="currRP" class="bold red"></span></div>
                    <div class="width25p">최고 rp : <span id="maxRP"></span></div>
                    <div id="playGameDiv">
                        <!-- 승률 : 50% [100승 101패 2중단]-->
                    </div>
                </div>
            </div>
            <div id="positionDiv">
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position1.jpg"> <span id="tankerSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position2.jpg"> <span id="meleeSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position3.jpg"> <span id="adSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position4.jpg"> <span id="suppSpan"></span></div>
            </div>
            <div id="recentlyDiv">
                <div class="width100p bold" id="recentlyDivTitle">
                    <!--최근 10게임 -->
                </div>
                <div id="recentlyResultDiv" class="width100p parent">

                </div>
            </div>
            <div id="mostCharDiv">
                <div id="mostCharTitleDiv" class="width100p bold">자주하는캐릭 TOP3</div>
                <div id="mostCharDetailDiv">
                    <!-- 자주하는 캐릭 top3 -->
                </div>
            </div>
        </div>

        <div id="template2" style="display:none">
            <div id="river" class="mapCard">
                <div class="bold width100p">리버포드</div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position1.jpg"> <span id="tankerSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position2.jpg"> <span id="meleeSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position3.jpg"> <span id="adSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position4.jpg"> <span id="suppSpan"></span></div>
                <div id="often" class="width100p">
                    <div id="mostCharTitleDiv" class="width100p bold">자주하는캐릭 TOP3</div>
                    <div id="mostCharDetailDiv">
                        <!-- 자주하는 캐릭 top3 -->
                    </div>
                </div>
            </div>
            <div id="metro" class="mapCard">
                <div class="bold width100p">메트로폴리스</div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position1.jpg"> <span id="tankerSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position2.jpg"> <span id="meleeSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position3.jpg"> <span id="adSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position4.jpg"> <span id="suppSpan"></span></div>
                <div id="often" class="width100p">
                    <div id="mostCharTitleDiv" class="width100p bold">자주하는캐릭 TOP3</div>
                    <div id="mostCharDetailDiv">
                        <!-- 자주하는 캐릭 top3 -->
                    </div>
                </div>
            </div>
            <div id="bristol" class="mapCard">
                <div class="bold width100p">브리스톨</div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position1.jpg"> <span id="tankerSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position2.jpg"> <span id="meleeSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position3.jpg"> <span id="adSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position4.jpg"> <span id="suppSpan"></span></div>
                <div id="often" class="width100p">
                    <div id="mostCharTitleDiv" class="width100p bold">자주하는캐릭 TOP3</div>
                    <div id="mostCharDetailDiv">
                        <!-- 자주하는 캐릭 top3 -->
                    </div>
                </div>
            </div>
            <div id="spring" class="mapCard">
                <div class="bold width100p">스프링필드</div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position1.jpg"> <span id="tankerSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position2.jpg"> <span id="meleeSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position3.jpg"> <span id="adSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position4.jpg"> <span id="suppSpan"></span></div>
                <div id="often" class="width100p">
                    <div id="mostCharTitleDiv" class="width100p bold">자주하는캐릭 TOP3</div>
                    <div id="mostCharDetailDiv">
                        <!-- 자주하는 캐릭 top3 -->
                    </div>
                </div>
            </div>
            <div id="asia" class="mapCard">
                <div class="bold width100p">그랑플람 아시아지부</div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position1.jpg"> <span id="tankerSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position2.jpg"> <span id="meleeSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position3.jpg"> <span id="adSpan"></span></div>
                <div class="width45p"><img class="drawIcon" src="http://static.cyphers.co.kr/img/game_position/position4.jpg"> <span id="suppSpan"></span></div>
                <div id="often" class="width100p">
                    <div id="mostCharTitleDiv" class="width100p bold">자주하는캐릭 TOP3</div>
                    <div id="mostCharDetailDiv">
                        <!-- 자주하는 캐릭 top3 -->
                    </div>
                </div>
            </div>
        </div>




</body>

</html>