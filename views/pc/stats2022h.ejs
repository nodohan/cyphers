<!DOCTYPE html>
<html lang="ko">

<head>
    <%- include  ("../layout/head") %>
        <script src="/js/charImage.js" crossorigin="anonymous"></script>
        <script type="text/javascript">
            var myChart;

            $(document).ready(function() {
                $("#mainMenu").removeClass("active");
                $("#stats2022h").addClass("active");

                getStats("statsList", drawStatsList);
            });

            function drawStatsList(data) {
                let mList = dataFilter(data.row, "A", "TANKER", "DESC");
                setStatsWDueDate("M", mList[0]);
                drawStatsListDiv("bestTanker", mList);
                drawStatsListDiv("worstTanker", dataFilter(data.row, "A", "TANKER", "ASC"));
                drawStatsListDiv("bestAttack", dataFilter(data.row, "A", "ATTACK", "DESC"));
                drawStatsListDiv("worstAttack", dataFilter(data.row, "A", "ATTACK", "ASC"));
                drawStatsListDiv("bestAll", dataFilter(data.row, "A", "ALL", "DESC"));
                drawStatsListDiv("worstAll", dataFilter(data.row, "A", "ALL", "ASC"));
            }

            function dataFilter(row, statsType, combiType, order) {
                let list = row.filter(item => item.statsType == statsType)
                    .filter(item => item.combiType == combiType)
                    .filter(item => item.order == order)
                    .sort(order == "DESC" ? lateDesc : lateAsc);
                return list;
            }

            function setStatsWDueDate(type, item) {
                let span = (type == "W") ? $("#wDueSpan") : $("#mDueSpan");
                span.empty();
                span.append(item.statsFromDate + "~" + item.statsToDate);
            }

            function drawStatsListDiv(divId, data) {
                var table = $("#matchInfoTemplate").clone();
                table.removeAttr("id");
                let tbody = table.find("tbody");

                if (data.length == 0) {
                    let tr = "<tr><td colspan='5'>데이터가 없습니다.</td></tr>";
                    tbody.append(tr);
                }

                let idx = 0;
                for (idx in data) {
                    if (idx >= 5) {
                        break;
                    }
                    let row = data[idx];
                    let tr = "<tr>";
                    tr += "<td>" + getChars(row.combi.split("|")) + "</td>";
                    tr += "<td>" + row.total + "</td>";
                    tr += "<td>" + row.win + "</td>";
                    tr += "<td>" + row.lose + "</td>";
                    tr += "<td>" + row.late + "%</td>";
                    tbody.append(tr);
                }

                $("#" + divId).append(table);
            }

            function getChars(arr) {
                let images = "";
                if (arr == "") {
                    return "<spna style='font-size:32px;'>탱커 없음</span>";
                }
                for (idx in arr) {
                    images += "&nbsp;&nbsp;&nbsp;<img data-item='" + arr[idx] + "' src='https://img-api.neople.co.kr/cy/characters/" + charMap.get(arr[idx]) + "'>"
                }
                return images;
            }

            function getStats(url, callback) {
                var result;
                $.ajax({
                    async: true,
                    url: "/stats/" + url,
                    data: {
                        'season': '2022H'
                    },
                    success: function(data) {
                        if (data.resultCode == -1) {
                            return;
                        }
                        callback(data);
                    },
                    error: function(data) {
                        return;
                    }
                }).done(function() {

                });
                return result;
            }
        </script>
</head>

<body class="body">
    <%- include  ("../layout/menu") %>

        <div id="statsMain">

            <div id="con1" class="conLayer">
                <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <a class="nav-link active" id="all-tab" data-toggle="tab" href="#all" role="tab" aria-controls="tanker" aria-selected="true">전체조합</a>
                        <a class="nav-link" id="tanker-tab" data-toggle="tab" href="#tanker" role="tab" aria-controls="tanker" aria-selected="true">탱커조합</a>
                        <a class="nav-link" id="attack-tab" data-toggle="tab" href="#attack" role="tab" aria-controls="attack" aria-selected="false">딜러조합</a>
                    </div>
                </nav>
                <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="all" role="tabpanel" aria-labelledby="tanker-tab">
                        <h4>Best 5</h4>
                        <div id="bestAll"></div>
                        <h4>Worst 5</h4>
                        <div id="worstAll"></div>
                    </div>
                    <div class="tab-pane fade" id="tanker" role="tabpanel" aria-labelledby="tanker-tab">
                        <h4>Best 5</h4>
                        <div id="bestTanker"></div>
                        <h4>Worst 5</h4>
                        <div id="worstTanker"></div>
                    </div>
                    <div class="tab-pane fade" id="attack" role="tabpanel" aria-labelledby="wAttack-tab">
                        <h4>Best 5</h4>
                        <div id="bestAttack"></div>
                        <h4>Worst 5</h4>
                        <div id="worstAttack"></div>
                    </div>
                </div>
            </div>
            <div id="con2" style="height:947px;" class="conLayer">
                <span class="h3Span"> 캐릭통계
                <div class="conStats">
                    <h4>작업중</h4>
                    
                </div>
                
            </div>

            <!-- 카카오 광고 -->
            <%- include  ("../layout/rightBanner") %>

        </div>


        <div style="display:none">
            <table id="matchInfoTemplate" class="table table-striped table-condensed">
                <thead class="thead-light">
                    <tr>
                        <th scope="col">조합</th>
                        <th scope="col">판수</th>
                        <th scope="col">승</th>
                        <th scope="col">패</th>
                        <th scope="col">승률</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>


</body>

</html>